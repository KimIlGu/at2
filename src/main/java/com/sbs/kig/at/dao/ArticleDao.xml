<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sbs.kig.at.dao.ArticleDao">
  <!-- yaml에서 type-aliases-package를 안해줬을 경우
  <select id="getForPrintArticles" resultType="con.sbs.kig.at.dto.Article">
    SELECT *
    FROM article
    ORDER BY id DESC
  </select>
   -->
   
  <select id="getForPrintArticles" resultType="Article">
    SELECT *
    FROM article
    WHERE displayStatus = 1
    ORDER BY id DESC
  </select>
  
  <!-- 달러 기호일줄 알았는데 샾을 쓰네 -->
  <select id="getForPrintArticleById" resultType="Article">
  	SELECT * 
  	FROM article
  	WHERE id = #{id}
  </select>
  
  <!-- useGeneratedKeys="true" => Auto_increment 허용 -->
  <insert id="write" useGeneratedKeys="true" keyProperty="id">
  	INSERT INTO article
  	SET regDate = NOW(),
  	updateDate = NOW(),
  	displayStatus = 1,
  	title = #{title},
  	body = #{body}
  </insert>
  
  <insert id="writeReply" useGeneratedKeys="true" keyProperty="id">
	INSERT INTO articleReply
	SET regDate = NOW(),
	updateDate = NOW(),
	body = #{body},
	memberId = #{memberId},
	articleId = #{articleId},
	displayStatus = 1
  </insert>
  
  <select id="getForPrintArticleReplies" resultType="ArticleReply">
  	<![CDATA[
	SELECT * 
  	FROM articleReply
  	WHERE articleId = #{articleId}
  	AND displayStatus = 1
	AND id >= #{from}
	ORDER BY id ASC
	]]>
  </select>
  
</mapper>